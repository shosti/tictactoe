// Generated by CoffeeScript 1.3.3
(function() {
  var Game;

  $(function() {
    var game;
    game = new Game;
    return $('td').click(function(e) {
      var col, row, _ref;
      _ref = this.id.split('').map(function(x) {
        return parseInt(x, 10);
      }), row = _ref[0], col = _ref[1];
      return game.move(row, col);
    });
  });

  Game = (function() {

    function Game(player) {
      this.player = player != null ? player : 'X';
      this.board = [[null, null, null], [null, null, null], [null, null, null]];
      this.isHumanTurn = this.player === 'X';
      this.drawBoard();
    }

    Game.prototype.move = function(row, col) {
      var _this = this;
      if (this.isHumanTurn && !this.board[row][col]) {
        this.board[row][col] = this.player;
        this.isHumanTurn = false;
        this.drawBoard();
        return $.ajax({
          url: 'move',
          data: {
            board: JSON.stringify(this.board)
          },
          success: function(data) {
            _this.board = JSON.parse(data);
            _this.isHumanTurn = true;
            return _this.drawBoard();
          },
          error: function(xhr, status, error) {
            return $('#status').text("Error: " + error);
          }
        });
      }
    };

    Game.prototype.drawBoard = function() {
      var col, id, row, _i, _j;
      for (row = _i = 0; _i <= 2; row = ++_i) {
        for (col = _j = 0; _j <= 2; col = ++_j) {
          id = "#" + row + col;
          $(id).text(this.board[row][col] || '');
        }
      }
      return $('#status').text(this.isHumanTurn ? 'Your turn' : "Computer's turn");
    };

    return Game;

  })();

}).call(this);
